<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Infaux{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block meta_description %}{% endblock %}
    {% block meta_keywords %}{% endblock %}
    {% block meta_robots %}{% endblock %}
    {% block meta_google %}{% endblock %}
    <link type="text/plain" rel="author" href="{{ preload('/humans.txt', { as: 'font', importance: 'low' }) }}"/>
    <link rel="manifest" href="{{ preload('/manifest.webmanifest.json', { as: 'font', importance: 'low' }) }}">


    {% block stylesheets %}

    {% endblock %}

    {{ encore_entry_link_tags('main') }}

    <link rel="icon" type="image/png" href="{{ preload('/img/favicon.png', { as: 'image' }) }}"/>
    <link rel="apple-touch-icon" sizes="96x96"
          href="{{ preload('/img/favicon96.png', { as: 'image', importance: 'low' }) }}">
    <link rel="apple-touch-icon" sizes="192x192"
          href="{{ preload('/img/favicon192.png', { as: 'image', importance: 'low' }) }}">
    <meta property="og:image" content="{{ preload('/img/icon.png', { as: 'image', importance: 'low' }) }}"/>
    <meta name="theme-color" content="#00103e">
    <script type="text/javascript"
            src="{{ preload('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js', { as: 'script' }) }}"
            defer></script>
    <script type="text/javascript"
            src="{{ preload(asset('js/tarteaucitron/tarteaucitron.js'), { as: 'script', importance: 'low' }) }}"></script>

    <script type="text/javascript" defer>
        tarteaucitron.init({
            "privacyUrl": "", /* Privacy policy url */

            "hashtag": "#tarteaucitron", /* Open the panel with this hashtag */
            "cookieName": "tarteaucitron", /* Cookie name */

            "orientation": "bottom", /* Banner position (top - bottom) */
            "showAlertSmall": false, /* Show the small banner on bottom right */
            "cookieslist": true, /* Show the cookie list */

            "adblocker": false, /* Show a Warning if an adblocker is detected */
            "AcceptAllCta": true, /* Show the accept all button when highPrivacy on */
            "highPrivacy": false, /* Disable auto consent */
            "handleBrowserDNTRequest": false, /* If Do Not Track == 1, disallow all */

            "removeCredit": true, /* Remove credit link */
            "moreInfoLink": false, /* Show more info link */
            "useExternalCss": false, /* If false, the tarteaucitron.css file will be loaded */

            //"cookieDomain": ".my-multisite-domaine.fr", /* Shared cookie for multisite */

            "readmoreLink": "/cookiespolicy" /* Change the default readmore link */
        });

        (tarteaucitron.job = tarteaucitron.job || []).push('recaptcha');
        tarteaucitron.user.gajsUa = 'UA-107718823-2';
        tarteaucitron.user.gajsMore = function () { /* add here your optionnal _ga.push() */
        };


    </script>
    {% block gtag %}{% endblock %}

</head>
{% include "header.html.twig" %}
<body>
<div id="mercure-content-receiver"></div>


{% block body %}

{% endblock %}



{% include "footer.html.twig" %}

<a aria-label="Button permettant de retourner en haut de la page" id="scrollToTop"></a>

<script src="{{ preload('https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js', { as: 'script' }) }}"></script>
<script src="{{ preload('https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js', { as: 'script' }) }}"
        defer></script>
<script src="{{ preload('https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js', { as: 'script' }) }}"
        defer></script>
<script src="{{ preload('https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js', { as: 'script' }) }}"
        defer></script>

{{ encore_entry_script_tags('app') }}


<script>
    var btn = $('#scrollToTop');

    $(window).scroll(function () {
        if ($(window).scrollTop() > 300) {
            btn.addClass('show');
        } else {
            btn.removeClass('show');
        }
    });

    btn.on('click', function (e) {
        e.preventDefault();
        $('html, body').animate({scrollTop: 0}, '300');
    });

</script>

<script>
    //PWA - Service worker et notifcation
    function notifyMe(msg) {
        if (!window.Notification) {
            console.log('Browser does not support notifications.');
        } else {
            // check if permission is already granted
            if (Notification.permission === 'granted') {
                // show notification here
                var notify = new Notification('Tu as reçu une notifications !', {
                    body: msg,
                    icon: '/img/logo_infaux.png',
                });
            } else {
                // request permission from user
                Notification.requestPermission().then(function (p) {
                    if (p === 'granted') {
                        // show notification here
                        var notify = new Notification('Tu as reçu une notifications !', {
                            body: msg,
                            icon: '/img/logo_infaux.png',
                        });
                    } else {
                        console.log('User blocked notifications.');
                    }
                }).catch(function (err) {
                    console.error(err);
                });
            }
        }
    }


</script>

{% if app.user %}

    <script type="text/javascript">
        $(document).ready(function () {

            //const _receiver = document.getElementById('mercure-content-receiver');
            const numberNotifs = $('.number_notif');
            const url = new URL('{{ mercure_publish_url }}');
            url.searchParams.append('topic', '/message');


            navigator.serviceWorker.register('/service-worker.js');
            Notification.requestPermission(function (result) {
                if (result === 'granted') {
                    navigator.serviceWorker.ready.then(function (registration) {
                        const eventSource = new EventSourcePolyfill(url, {
                            headers: {
                                'Authorization': 'Bearer {{ bearerToken }}'
                            }
                        });

                        eventSource.onmessage = (evt) => {
                            const data = JSON.parse(evt.data);
                            if (!data.message) {
                                return;
                            }
                            numberNotifs[0].innerText++;
                            //  notifyMe(data.message);
                            console.log(data);
                            registration.showNotification(data.message);

                        };
                    })


                }
                ;
            });
        })


    </script>
{% endif %}


{% block javascripts %}{% endblock %}

</body>
</html>
